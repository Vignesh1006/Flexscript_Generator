<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI FlexSim Code Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .ai-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            margin-top: 10px;
        }

        .content {
            padding: 40px;
        }

        .input-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: 'ü§ñ';
            font-size: 24px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            min-height: 120px;
            resize: vertical;
            transition: all 0.3s;
        }

        textarea:focus, input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .example-prompts {
            margin-top: 15px;
        }

        .example-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .prompt-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .prompt-chip {
            padding: 10px 16px;
            background: white;
            color: #667eea;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .prompt-chip:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-generate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-clear {
            background: #f0f0f0;
            color: #666;
        }

        .btn-clear:hover {
            background: #e0e0e0;
        }

        .btn-copy {
            background: #10b981;
            color: white;
        }

        .btn-copy:hover {
            background: #059669;
        }

        .output-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .output-section.show {
            display: block;
            animation: slideIn 0.4s ease;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-output::-webkit-scrollbar {
            width: 10px;
        }

        .code-output::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 10px;
        }

        .code-output::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .loading-container {
            display: none;
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-top: 30px;
        }

        .loading-container.show {
            display: block;
            animation: slideIn 0.4s ease;
        }

        .spinner {
            width: 50px;
            height: 50px;
            margin: 0 auto 20px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-text {
            font-size: 16px;
            color: #667eea;
            font-weight: 600;
        }

        .loading-subtext {
            font-size: 14px;
            color: #888;
            margin-top: 10px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .feature-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .feature-desc {
            font-size: 13px;
            color: #666;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .features {
                grid-template-columns: 1fr;
            }
        }

        .syntax-keyword { color: #569cd6; }
        .syntax-function { color: #dcdcaa; }
        .syntax-string { color: #ce9178; }
        .syntax-comment { color: #6a9955; }
        .syntax-number { color: #b5cea8; }
        .syntax-variable { color: #9cdcfe; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                ü§ñ AI FlexSim Code Generator
                <span class="ai-badge">Powered by Claude AI</span>
            </h1>
            <p>Describe any FlexSim scenario in plain English - AI generates the exact code you need</p>
            <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                Prepared by <strong>Vignesh S</strong>
            </p>
        </div>

        <div class="content">
            <!-- Success Alert -->
            <div class="alert alert-success" id="successAlert">
                ‚úÖ Code copied to clipboard!
            </div>

            <!-- Error Alert -->
            <div class="alert alert-error" id="errorAlert">
                ‚ùå <span id="errorMessage">Something went wrong. Please try again.</span>
            </div>

            <!-- Info Alert -->
            <div class="alert alert-info" id="infoAlert">
                üí° <strong>Tip:</strong> Be specific about what you want. Mention triggers (On Entry, On Exit, On Arrival), object names, and conditions.
            </div>

            <!-- API Key Configuration -->
            <div class="input-section" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);">
                <div class="section-title" style="color: #2d3436;">üîë API Key Configuration</div>
                <div class="input-group">
                    <label style="color: #2d3436;">Claude API Key</label>
                    <input
                        type="password"
                        id="apiKey"
                        placeholder="sk-ant-api03-xxxxx..."
                        style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 15px; font-family: inherit; transition: all 0.3s;"
                    />
                    <p style="font-size: 13px; color: #636e72; margin-top: 10px;">
                        üìò Don't have an API key? Get one at <a href="https://console.anthropic.com/settings/keys" target="_blank" style="color: #667eea; font-weight: 600;">console.anthropic.com</a>
                    </p>
                    <p style="font-size: 12px; color: #636e72; margin-top: 5px;">
                        üîí Your API key is stored locally in your browser and never shared with anyone.
                    </p>
                </div>
                <button
                    class="btn-generate"
                    onclick="saveApiKey()"
                    style="width: auto; margin-top: 10px; padding: 12px 24px; font-size: 14px;"
                >
                    <span>üíæ</span> Save API Key
                </button>
                <div id="apiKeyStatus" style="margin-top: 10px; font-size: 13px; font-weight: 600;"></div>
            </div>

            <!-- Features -->
            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <div class="feature-title">Natural Language</div>
                    <div class="feature-desc">Describe in plain English, no need for technical terms</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <div class="feature-title">Instant Generation</div>
                    <div class="feature-desc">Get production-ready FlexScript code in seconds</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üß†</div>
                    <div class="feature-title">Smart Context</div>
                    <div class="feature-desc">AI understands FlexSim logic and best practices</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ú®</div>
                    <div class="feature-title">Any Scenario</div>
                    <div class="feature-desc">Queues, transporters, routing, labels - anything!</div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-section">
                <div class="section-title">Describe Your Scenario</div>
                
                <div class="input-group">
                    <label>What do you want FlexSim to do?</label>
                    <textarea 
                        id="userPrompt" 
                        placeholder="Example: When a transporter arrives at control point CP1, I want to open Queue1's output port and close Queue2's output port. Then when the transporter leaves the control point, reverse it - close Queue1 and open Queue2."
                    ></textarea>
                </div>

                <div class="example-prompts">
                    <div class="example-title">üí° Try these examples (click to use):</div>
                    <div class="prompt-chips">
                        <div class="prompt-chip" onclick="useExample(this)">
                            Open Queue1 when AGV arrives at Control Point, close it when AGV leaves
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Route items to port 1 if priority > 5, otherwise port 2
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Process time should be 20 seconds for Type 1 items, 30 seconds for Type 2
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Assign random priority between 1-10 to each item when created
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Pull highest priority item from queue, considering wait time
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Schedule breakdown every 3600 seconds, repair time 300 seconds
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            When transporter is loaded, open unloading queue. When empty, open loading queue
                        </div>
                        <div class="prompt-chip" onclick="useExample(this)">
                            Track cycle time: record arrival time on entry, calculate on exit
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-generate" id="generateBtn" onclick="generateAICode()">
                        <span>üöÄ</span> Generate FlexScript Code
                    </button>
                    <button class="btn-clear" onclick="clearAll()">
                        <span>üóëÔ∏è</span> Clear
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-container" id="loadingContainer">
                <div class="spinner"></div>
                <div class="loading-text">AI is generating your FlexScript code...</div>
                <div class="loading-subtext">Analyzing your scenario and creating optimized code</div>
            </div>

            <!-- Output Section -->
            <div class="output-section" id="outputSection">
                <div class="code-header">
                    <div class="section-title" style="margin-bottom: 0;">Generated FlexScript Code</div>
                    <button class="btn-copy" onclick="copyCode()" style="flex: 0 0 auto; padding: 10px 20px;">
                        <span>üìã</span> Copy Code
                    </button>
                </div>
                <div class="code-output" id="codeOutput"></div>
            </div>
        </div>

        <!-- Footer with Author Credit -->
        <div style="text-align: center; margin-top: 40px; padding: 30px; background: rgba(255,255,255,0.95); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <p style="margin: 0; color: #666; font-size: 14px;">
                <strong style="color: #667eea;">Powered by Claude AI</strong>
            </p>
            <p style="margin: 10px 0 0 0; color: #333; font-size: 16px; font-weight: 600;">
                Prepared by Vignesh S
            </p>
            <p style="margin: 10px 0 0 0; color: #888; font-size: 13px;">
                AI-Powered FlexSim Code Generator ¬© 2024
            </p>
        </div>
    </div>

    <script>
        // Show info alert on load
        window.onload = () => {
            // Load saved API key
            const savedApiKey = localStorage.getItem('claudeApiKey');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
                updateApiKeyStatus('‚úÖ API Key loaded from storage', '#10b981');
            } else {
                updateApiKeyStatus('‚ö†Ô∏è Please configure your API key first', '#f59e0b');
            }

            document.getElementById('infoAlert').classList.add('show');
            setTimeout(() => {
                document.getElementById('infoAlert').classList.remove('show');
            }, 5000);
        };

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                updateApiKeyStatus('‚ùå Please enter an API key', '#ef4444');
                return;
            }

            if (!apiKey.startsWith('sk-ant-')) {
                updateApiKeyStatus('‚ö†Ô∏è API key should start with "sk-ant-"', '#f59e0b');
                return;
            }

            localStorage.setItem('claudeApiKey', apiKey);
            updateApiKeyStatus('‚úÖ API Key saved successfully!', '#10b981');

            // Hide the message after 3 seconds
            setTimeout(() => {
                document.getElementById('apiKeyStatus').style.opacity = '0';
            }, 3000);
        }

        function updateApiKeyStatus(message, color) {
            const statusElement = document.getElementById('apiKeyStatus');
            statusElement.textContent = message;
            statusElement.style.color = color;
            statusElement.style.opacity = '1';
            statusElement.style.transition = 'opacity 0.3s';
        }

        function useExample(element) {
            document.getElementById('userPrompt').value = element.textContent.trim();
            // Smooth scroll to textarea
            document.getElementById('userPrompt').scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Focus and highlight
            document.getElementById('userPrompt').focus();
        }

        async function generateAICode() {
            const userPrompt = document.getElementById('userPrompt').value.trim();

            if (!userPrompt) {
                showError('Please describe what you want to do in FlexSim');
                return;
            }

            // Check if API key is configured
            const apiKey = localStorage.getItem('claudeApiKey');
            if (!apiKey) {
                showError('Please configure your Claude API Key first. Scroll up to the API Key Configuration section.');
                // Scroll to API key section
                document.getElementById('apiKey').scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.getElementById('apiKey').focus();
                return;
            }

            // Hide previous outputs
            document.getElementById('outputSection').classList.remove('show');
            document.getElementById('errorAlert').classList.remove('show');

            // Show loading
            const loadingContainer = document.getElementById('loadingContainer');
            loadingContainer.classList.add('show');

            // Disable button
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div style="width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite;"></div> Generating...';

            try {
                // Call Claude API
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [
                            {
                                role: 'user',
                                content: `You are a FlexSim expert code generator. Generate ONLY FlexScript code based on the user's description.

CRITICAL RULES FOR OUTPUT - READ CAREFULLY:
1. Output ONLY pure FlexScript code - absolutely NO HTML tags, NO XML tags, NO markdown formatting
2. Do NOT wrap code in backticks, code blocks, or any special formatting
3. Do NOT include ANY markup phrases like "syntax-comment", "syntax-keyword", "syntax-function", etc.
4. Do NOT include ANY HTML span tags or class attributes
5. Do NOT use any form of syntax highlighting markup in your response
6. Include helpful comments using ONLY // for single line or /* */ for multi-line
7. Use proper FlexSim syntax and functions
8. Be specific about which trigger to use (put it in a comment at the top using //)
9. Include variable declarations and proper error handling where needed
10. The code should be ready to copy-paste directly into FlexSim

CRITICAL: Your response must be PURE PLAIN TEXT CODE. Think of it as typing code directly into a text editor like Notepad - no formatting whatsoever. Just code with // comments.

EXAMPLE OF CORRECT OUTPUT:
// Control Point - On Arrival Trigger
treenode transporter = parnode(1);
closeoutput(queue, 0);

EXAMPLE OF WRONG OUTPUT (DO NOT DO THIS):
syntax-comment">// Control Point
<span class="syntax-keyword">treenode</span>

USER'S SCENARIO:
${userPrompt}

Generate the complete, production-ready FlexScript code now. Remember: ONLY PLAIN TEXT CODE WITH // COMMENTS. NO MARKUP OF ANY KIND.`
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    let errorMessage = 'Failed to generate code. ';

                    switch (response.status) {
                        case 401:
                            errorMessage += 'Invalid API key. Please check your API key and try again.';
                            break;
                        case 403:
                            errorMessage += 'Access forbidden. Please verify your API key has proper permissions.';
                            break;
                        case 429:
                            errorMessage += 'Rate limit exceeded. Please wait a moment and try again.';
                            break;
                        case 500:
                        case 502:
                        case 503:
                            errorMessage += 'Claude API is temporarily unavailable. Please try again in a moment.';
                            break;
                        default:
                            errorMessage += `API error (${response.status}): ${errorData.error?.message || 'Unknown error'}`;
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();

                // Validate response structure
                if (!data.content || !data.content[0] || !data.content[0].text) {
                    throw new Error('Invalid response format from API. Please try again.');
                }

                let code = data.content[0].text;

                // COMPREHENSIVE CODE CLEANING
                // Step 1: Remove markdown code blocks
                code = code.replace(/```[\w]*\n?/g, '').trim();
                
                // Step 2: Remove ALL HTML/XML tags
                code = code.replace(/<\/?[^>]+(>|$)/g, '');
                
                // Step 3: Remove syntax highlighting patterns (multiple formats)
                code = code.replace(/syntax-(comment|keyword|function|string|number|variable)">/g, '');
                code = code.replace(/<span class="syntax-[^"]*">/g, '');
                code = code.replace(/<\/span>/g, '');
                
                // Step 4: Remove any remaining angle brackets and quotes artifacts
                code = code.replace(/&lt;/g, '<');
                code = code.replace(/&gt;/g, '>');
                code = code.replace(/&quot;/g, '"');
                code = code.replace(/&amp;/g, '&');
                code = code.replace(/"|"/g, '"');
                code = code.replace(/'/g, "'");
                
                // Step 5: Clean up specific syntax markup patterns
                code = code.replace(/syntax-comment">|syntax-keyword">|syntax-function">|syntax-string">|syntax-number">|syntax-variable">/g, '');
                
                // Step 6: Remove any standalone HTML entities
                code = code.replace(/&[a-z]+;/gi, '');
                
                // Step 7: Final cleanup - ensure proper formatting
                code = code.trim();

                // Display the code
                displayCode(code);

            } catch (error) {
                console.error('Error:', error);

                // Determine error type and show appropriate message
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    showError('Network error: Please check your internet connection and try again.');
                } else if (error.message.includes('CORS')) {
                    showError('CORS error: This app needs to be accessed via a web server or as a local file. Some browsers may block direct API calls.');
                } else {
                    showError(error.message || 'Failed to generate code. Please try again.');
                }
            } finally {
                // Hide loading
                loadingContainer.classList.remove('show');
                
                // Re-enable button
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span>üöÄ</span> Generate FlexScript Code';
            }
        }

        function displayCode(code) {
            const outputSection = document.getElementById('outputSection');
            const codeOutput = document.getElementById('codeOutput');
            
            // AGGRESSIVE CLEANING - Second layer of defense
            // Remove any HTML/XML tags
            code = code.replace(/<\/?[^>]+(>|$)/g, '');
            
            // Remove ALL syntax markup patterns
            code = code.replace(/syntax-(comment|keyword|function|string|number|variable)">/g, '');
            code = code.replace(/<span[^>]*>/g, '');
            code = code.replace(/<\/span>/g, '');
            
            // Clean up HTML entities
            code = code.replace(/&lt;/g, '<');
            code = code.replace(/&gt;/g, '>');
            code = code.replace(/&quot;/g, '"');
            code = code.replace(/&amp;/g, '&');
            
            // Remove any text that looks like: syntax-anything">
            code = code.replace(/syntax-\w+">/g, '');
            
            // Final trim
            code = code.trim();
            
            // Apply syntax highlighting (for visual display only)
            const highlightedCode = applySyntaxHighlighting(code);
            
            codeOutput.innerHTML = highlightedCode;
            outputSection.classList.add('show');
            
            // Scroll to output
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function applySyntaxHighlighting(code) {
            return code
                // Comments (must be first to avoid highlighting keywords in comments)
                .replace(/\/\/.*/g, '<span class="syntax-comment">$&</span>')
                .replace(/\/\*[\s\S]*?\*\//g, '<span class="syntax-comment">$&</span>')
                // Keywords
                .replace(/\b(treenode|int|double|string|if|else|for|while|return|switch|case|break|void|Array|Table)\b/g, '<span class="syntax-keyword">$&</span>')
                // Functions
                .replace(/\b(parnode|node|getlabelnum|setlabelnum|getlabelstr|setlabelstr|content|closeoutput|closeinput|print|time|delay|getitemtype|setitemtype|traveltoloc|load|unload|getvarnum|setvarnum|getstat|rank|first|last|duniform|uniform|normal|exponential|triangular|setcolor|scheduledowntime|capacity|getoutputstatus|getinputstatus|objectexists|createcopy|createinstance|sendto|delay|fmod|concat|numtostring|strcmp|msgparam|delayedmsg|settaskpriority|gettraveltime|getspeed|setspeed|Vec3|group)\b(?=\s*\()/g, '<span class="syntax-function">$&</span>')
                // Strings
                .replace(/"([^"\\]*(\\.[^"\\]*)*)"/g, '"<span class="syntax-string">$1</span>"')
                // Numbers
                .replace(/\b(\d+\.?\d*)\b/g, '<span class="syntax-number">$&</span>')
                // Variables (common FlexSim variables)
                .replace(/\b(current|item|queue|transporter|processor|model)\b/g, '<span class="syntax-variable">$&</span>');
        }

        function copyCode() {
            const codeOutput = document.getElementById('codeOutput');
            const text = codeOutput.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                const successAlert = document.getElementById('successAlert');
                successAlert.classList.add('show');
                setTimeout(() => {
                    successAlert.classList.remove('show');
                }, 3000);
            }).catch(err => {
                showError('Failed to copy code to clipboard');
            });
        }

        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorAlert.classList.add('show');
            
            setTimeout(() => {
                errorAlert.classList.remove('show');
            }, 5000);
        }

        function clearAll() {
            document.getElementById('userPrompt').value = '';
            document.getElementById('outputSection').classList.remove('show');
            document.getElementById('loadingContainer').classList.remove('show');
            document.getElementById('errorAlert').classList.remove('show');
            document.getElementById('successAlert').classList.remove('show');
        }

        // Handle Enter key in textarea (Shift+Enter for generate)
        document.getElementById('userPrompt').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.shiftKey) {
                e.preventDefault();
                generateAICode();
            }
        });
    </script>
</body>
</html>
